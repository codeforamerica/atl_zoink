

<div id="chart-container"></div>

<% content_for(:js_footer) do %>
<script type="text/javascript">

    d3.json("/api/v0/citations-per-defendant.json" , function(error, response){
        console.log(response.length)
        console.log(response)
        console.log(response[0])

        var response = [
          {"citation_count":1, "defendant_count":100000},
          {"citation_count":2, "defendant_count":40000},
          {"citation_count":3, "defendant_count":15000},
          {"citation_count":4, "defendant_count":6000},
          {"citation_count":5, "defendant_count":2000},
          {"citation_count":6, "defendant_count":700},
          {"citation_count":7, "defendant_count":100},
        ]

        var data_categories = [0] // we don't (yet) have data on how many defendants do not have a citation
        var citation_counts = response.map(function(row){ return row["citation_count"] })
        data_categories = data_categories.concat(citation_counts)

        var atl_series_data = [null] // we don't (yet) have data on how many defendants do not have a citation
        var defendant_counts = response.map(function(row){ return parseInt(row["defendant_count"]) })
        atl_series_data = atl_series_data.concat(defendant_counts)

        $('#chart-container').highcharts({
            chart: {
                type: 'area'
            },
            title: {
                text: 'Distribution of Citations per Defendant'
            },
            subtitle: {
                text: 'since the dataset lacks person identifiers, this chart uses distinct person names'
            },
            xAxis: {
                title:{
                    text:'Distinct count of citation_id'
                },
                allowDecimals: false,
                labels: {
                    formatter: function () {
                        return this.value; // clean, unformatted number
                    }
                },
                categories: data_categories
            },
            yAxis: {
                title: {
                    text: 'Distinct count of defendant_full_name'
                },
                labels: {
                    formatter: function () {
                        //return this.value / 1000 + 'k';
                        return this.value;
                    }
                }
            },
            tooltip: {
                pointFormat: '{point.y:,.0f} distinct defendant names have been cited {point.x} times.'
            },
            plotOptions: {
                area: {
                    //pointStart: 0,
                    marker: {
                        enabled: true,
                        symbol: 'circle',
                        radius: 5,
                        //states: {
                        //    hover: {
                        //        enabled: true
                        //    }
                        //}
                    }
                }
            },
            series: [{
                name: 'ATL',
                data: atl_series_data,
                color: 'steelblue'
            }]
        }); // highcharts()


    }); // d3.json

</script>
<% end %>
